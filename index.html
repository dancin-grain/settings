<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Document</title>
    
    <style>
            body{
        background-color: #fdf9ee;
        font-family: 'Google Sans', Roboto, Helvetica, Arial, sans-serif;
      }
     #introEntire, .whiteRoundedBox {
    /* font-family: Roboto,RobotoDraft,Helvetica,Arial,sans-serif; */
    /* word-wrap: break-word; */
    /* transition: box-shadow 280ms cubic-bezier(0.4,0,0.2,1); */
    border: 1px solid #dadce0;
    border-radius: 8px;
    /* display: flex; */
    
    background-color: white;
    /* background-color: #fff; */
    /* position: relative; */
    /* box-shadow: none; */
    }

    body{
        width:800px;
        margin:0 auto;
    }

   

    #darkOrange{
        
    /* word-wrap: break-word; */
    /* border-top-left-radius: 8px; */
    /* border-top-right-radius: 8px; */
    height: 10px;
    /* left: -1px; */
    /* position: absolute; */
    /* top: -1px; */
    /* width: calc(100% + 2px); */
    background-color: rgb(246, 227, 171);
    color: rgba(0, 0, 0, 1);
    }

    #intro{
        
        padding-left: 25px;
        padding-right: 25px;
        height:166px;
    }

    .twentyPcent{
      font-size: 25px;
    }
    select{

        padding: 2px 3px;
        /* border: 2px solid rgb(118, 118, 118); */
        width: 162.4px;
        box-sizing: content-box;

    }

    .plus, .minus{
      vertical-align: bottom;
      box-sizing: border-box;
      display: inline-block;
      margin-left: 12px;
     
      width: 21.47px;
      height: 21.47px;
      border-radius: 1px;
      line-height: 17.4px;
      background-color: transparent;
      color: rgb(180, 180, 180);
      text-align: center;
      border: 1px solid rgb(180 180 180);
      cursor: pointer;
      margin-bottom: 0px;
    }

    .minus{
      font-weight:bolder;
    }

    /* label{
      display: inline-block;
      margin-bottom: 5px;
    } */

    section{
      margin-bottom: 5px;
    }
    button{
        background-color: white;
        border: 1px solid #dadce0;
        border-radius: 5px;
        color: rgb(156, 117, 0);
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
       
        margin-right: 12px;
        cursor: pointer;
    }

    /* #addASet{
      color: rgb(156, 117, 0);
      background-color: #fef9ee;
    } */
    
    .smaller {
      color: #606060;
      font-size: 13.5px;
    }
    input[name="Address"]{
      width:324.8px;
    }

    ul{
      padding-left: 16px;
      margin-bottom: 25px;
    }

    li{
      padding-bottom: 7px;
    }
    input[type="submit"]{
        

    background-color: white;
        border: 1px solid #dadce0;
        border-radius: 5px;
        color: rgb(156, 117, 0);
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
       
        margin-right: 12px;
        cursor: pointer;
    }

    .whiteRoundedBox{
        margin-top: 12px;
        padding-top: 10px;
        padding-left: 25px;
        padding-right: 25px;
        padding-bottom: 25px;
    }
     ::-webkit-scrollbar{
                width:10px;
            }
            ::-webkit-scrollbar-track{
                border-radius: 5px;
            }

            ::-webkit-scrollbar-thumb{
                border-radius: 5px;
                background-color: rgb(246, 227, 171);
            }


  @media screen and (max-width: 900px){
        body{
          width:100%;
          
      }

      #intro {
          
          height: auto;
      }

      textarea {
        width: calc(100% - 30px);
      }

      img{
        width: 100%;
      }
    }
    </style>

</head>
<body>
    <p id="asd"></p>
        <form name="google-sheet" method="POST" >
            <div id="introEntire">
              <div id="darkOrange"></div>
              <div id="intro">
                <h1>Dancin Grain Subscription Settings</h1>
                <p id="changeMsgIfExpired">Pause or resume your subscription or adjust the drinks for each week!</p>
                <p id="removeIfExpired" style="line-height: 1.6;">Disclaimer: Changes will take place next week,<b> however</b>, changes made from sunday 11.00am to 11.59pm will take place the week after the next.</p>
              </div>
            </div>
            <div id="section1">

              <div class="whiteRoundedBox" id="preset"> 
                <!-- id and function name canot be the same, otherwise u cant call addSet -->
                <p>Subscription Plan&nbsp;&nbsp;&nbsp;</p>
                
                <p class="smaller" style="margin-bottom:23px;">Your subscription plan is currently <b>ACTIVE</b>, would you like to pause your subscription plan? (Please click the "Save All Changes" button to save any changes made.)</p>  
                <button type="button" style="width:65px;background-color: rgb(156, 117, 0);color: white;">No</button><button type="button" style="width:65px;">Yes</button>
              
                
            </div>
              

              
      
              <div class="whiteRoundedBox"> 
                  <p>No. of Berry Nice</p>
                  <input type="number" id="berryNice" class="noOfBottle" oninput="calculateTotalBottles1(this.value, 1)" name="No. of Berry Nice" min="0" value="0"><p class="minus" onclick="minus($('#berryNice'), 1)">-</p><p class="plus" onclick="plus($('#berryNice'), 1)">+</p> 
              </div>
          
              <div class="whiteRoundedBox"> 
                  <p>No. of Passion Fruit</p>
                  <input type="number" id="passionFruit" class="noOfBottle" oninput="calculateTotalBottles1(this.value, 2)" name="No. of Passion Fruit" min="0" value="0"><p class="minus" onclick="minus($('#passionFruit'), 2)">-</p><p class="plus" onclick="plus($('#passionFruit'), 2)">+</p> 
              </div>
      
              <div class="whiteRoundedBox"> 
                  <p>No. of Rose Lychee</p>
                  <input type="number" id="roseLychee" class="noOfBottle" oninput="calculateTotalBottles1(this.value, 3)" name="No. of Rose Lychee" min="0" value="0"><p class="minus" onclick="minus($('#roseLychee'), 3)">-</p><p class="plus" onclick="plus($('#roseLychee'), 3)">+</p> 
              </div>
      
              <div class="whiteRoundedBox"> 
                  <p>No. of Floral Blend</p>
                  <input type="number" id="floralBlend" class="noOfBottle" oninput="calculateTotalBottles1(this.value, 4)" name="No. of Floral Blend" min="0" value="0"><p class="minus" onclick="minus($('#floralBlend'), 4)">-</p><p class="plus" onclick="plus($('#floralBlend'), 4)">+</p> 
              </div>

              <div class="whiteRoundedBox"> 
                <p>No. of Chrysanthemum</p>
                <input type="number" id="chrysanthemum" class="noOfBottle" oninput="calculateTotalBottles1(this.value, 5)" name="No. of Chrysanthemum" min="0" value="0"><p class="minus" onclick="minus($('#chrysanthemum'), 5)">-</p><p class="plus" onclick="plus($('#chrysanthemum'), 5)">+</p> 
            </div>
            <!-- <input type="hidden" name="Presets">
            <input type="hidden"  name="Total Bottles">
            <input type="hidden"  name="Total Price"> -->
            
      
            <p class="totalPrice"></p>
      
            <input type="submit" id="submitBtn" value="Save All Changes">
              <p></p>
            </div>
            <!-- <input type="button" id="submitBtn" onclick="submission(this)" value="Upload Files"/> -->
              
          </form>









          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      
    //   document.getElementById('submitBtn').addEventListener('click', 
    //   function(e){
    //       $('#submitBtn').prop('disabled', true);
    //      google.script.run.withSuccessHandler(onSuccess).uploadFiles(this.parentNode.parentNode); // this.parentNode wont work as uploadFiles is expecting a form element as an object to access the myFile property/element
    //   });
      // function submission(e){
      //   google.script.run.uploadFiles(e.parentNode);
      // }

    //   function onSuccess(data){
    //     if(document.getElementById("myFile").value == ""){
    //       alert("Please upload a screen shot of the 'Transaction Ref. No./Google Transcation ID'");
    //       $('#submitBtn').prop('disabled', false);
    //       return;
    //     }
    //     document.getElementsByName('entry.1020438313')[0].value =  data;
    //     $("input[type='submit']").trigger("click");
    //   }















    // var options = {year: '2-digit', month: 'short', day: 'numeric' };
    // var options2 = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' };
    // var today  = new Date();
    // var slackTimeDaysDelivery = {"Mon": 8, "Tue": 7, "Wed": 6, "Thu": 5, "Fri": 4, "Sat": 10, "Sun": 9};
   

    // $("#deliveryDate").text("**All selected drinks will be delivered every Tuesday till the end of the billing period from" + new Date(Date.now() + 1000*60*60*24*slackTimeDaysDelivery[today.toLocaleDateString("en-US", options2).substring(0,3)]).toLocaleDateString("en-US", options) + ", (7pm to 10pm)**");





    var options = {year: '2-digit', month: 'short', day: 'numeric' };



    var berryNiceNo = 0;
    var passionFruitNo = 0;
    var roseLycheeNo = 0;
    var floralBlendNo = 0;   
    var chrysanthemumNo = 0; 
    var shipping = 0;
    var separateAndPresetsArray = [];
    var presetTextArray = [];
    var totalNoPart2 = 0;
    var totalPrice = 0;
    var totalNo = 0;
    function calculateTotalBottles1(v, n){
      if(v ==""){
          v = 0;
      }

      if(v % 1 != 0 || v < 0){
        $('.totalPrice').html('');
        return false;
      }

     
      

      switch(n){
        case 1:
          berryNiceNo = parseInt(v);
          break;
        case 2:
          passionFruitNo = parseInt(v);
          break;
        case 3:
          roseLycheeNo = parseInt(v);
          break;
        case 4:
          floralBlendNo = parseInt(v);   
          break;
        case 5:
          chrysanthemumNo = parseInt(v);   
          break;
      }
      totalNo = berryNiceNo + passionFruitNo + roseLycheeNo + floralBlendNo + chrysanthemumNo;

    }

    


    var setCounter = 1;
    var setCounterV2 = 1;
    var setAlphabet = 'A';

   


    function minus(v, n){
      if(v.val()=="" || v.val() % 1 != 0 || v.val() <= 0){
        v.val(0);
        calculateTotalBottles1("0", n); // need to do this because 0 == "" is true
        return;
      }
      v.val(v.val()-1);

      calculateTotalBottles1(v.val(), n);
      


    }

    function plus(v, n){
      if(v.val()=="" || v.val() % 1 != 0 || v.val() < 0){
        v.val(1);
        calculateTotalBottles1(1, n);
        return;
      }
      v.val(parseInt(v.val())+1);
      calculateTotalBottles1(v.val(), n);


    }
    



    var regions = {
        regionOne: [01, 02, 03, 04, 05, 06, 07, 08, 14, 15, 16, 09, 10, 11, 12, 13, 17, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 81, 51, 52, 53, 54, 55, 82, 56, 57],
        regionTwo: [58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 77, 78, 75, 76, 79, 80]
      }

      var options2 = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' };
      var today  = new Date();
      var slackTimeDaysDeliveryReg1 = {"Mon": 10, "Tue": 9, "Wed": 8, "Thu": 7, "Fri": 6, "Sat": 5, "Sun": 4};
     // var slackTimeDaysDeliveryReg2 = {"Mon": 10, "Tue": 9, "Wed": 8, "Thu": 7, "Fri": 6, "Sat": 5, "Sun": 4};
      var deliveryDates = [];
    function getAddress(e){
      console.log(e);
        if(e.value.length == 6 && !isNaN(e.value)){
          $.ajax({
            url:'https://geocode.xyz/' + e.value +'?region=SG',
            type:'GET',
            success: function(data){
                $("input[name='Address']").val($(data).find('#data > ol > li:nth-child(1) > a').text());
                
                if(regions.regionOne.includes(parseInt(e.value.substring(0,2))) || regions.regionTwo.includes(parseInt(e.value.substring(0,2)))){
                  
                    
                      $("#deliveryDate").text("Please take note of your first delivery date: " + new Date(Date.now() + 1000*60*60*24*slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)]).toLocaleDateString("en-US", options) + ", (7pm to 10pm)");
                      deliveryDates.push(new Date(Date.now() + 1000*60*60*24*slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)]).toLocaleDateString("en-US", options));
                      var g = $("#mplan").val() == 0.9 ? 8 : 12
                      for(i = 1; i < g; i++){
                        deliveryDates.push(new Date(Date.now() + 1000*60*60*24*(slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)] + (i*7) )).toLocaleDateString("en-US", options))
                      }


                    
                }else{
                  $("#deliveryDate").text("");
                }
            },
            error: function (jqXHR, textStatus, errorThrown) { $("input[name='Address']").val(""); $("#deliveryDate").text("");}
          });



        }else{
          $("input[name='Address']").val(""); $("#deliveryDate").text("");
        }
      }

     
      

    $(document).ready(function() {

      


     var section1InputTextValueReqlength = $('.section1InputText').length;
     var giftInputReqlength = $('.giftInput').length;
     
      var section3InputTextValueReqlength = $('.section3InputText').length;
      var sect2Or3;
      var section1InputTextValue;
      var section1InputTextValueNoOfBottle;
      var section1InputTextValueNoOfBottleReqlength = 0;



    

      
   
    
    
		
    

     
 });
    


    </script>













          <!-- <script>
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxL5k8P9-vVTUaTTZqmQgxu85oaJTRhJBy5uec0t2_aao6xassFzhSGXCkRxuP3JUlB0Q/exec'
            const form = document.forms['google-sheet']
          var a;
            form.addEventListener('submit', e => {
              e.preventDefault()
            
              fetch(scriptURL, { method: 'POST', body: new FormData(form)}) // new FormData contains a literal object with name/value pairs from the form
                .then(response => alert("great"))
                .catch(error => console.error('Error!', error.message))
            })
          </script> -->




          <script>

            let params = new URLSearchParams(location.search);
                  var id = params.get('id');
                  var pc = params.get('pc');

                  if(id == null || pc == null){
                    window.location.replace("https://dancin-grain.github.io/subscription/");
                  }
                  varBoolOrArr = google.script.run.searchAndRetrieveDeliDatesAndSelectedDrinks(id, pc);
                  if (varBoolOrArr == false){
                    $("#section1").remove();
                    $("#changeMsgIfExpired").html("Your subscription has expired. click <a href='https://dancin-grain.github.io/subscription/'>here</a> to subscribe again.");
                    $("#removeIfExpired").remove();
                  }else{
                    // display all delivery dates
                    // display selected drinks
                  }







              const form = document.forms['google-sheet'];
              form.addEventListener("submit", (e) => {
                e.preventDefault();
               

                if($("#section4").is(":hidden")){
                  return;
                }
                $('#submitBtn').prop('disabled', true);
                if(form['(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID'].value == ''){
                  alert('𝐏𝐥𝐞𝐚𝐬𝐞 𝐮𝐩𝐥𝐨𝐚𝐝 𝐚 𝐬𝐜𝐫𝐞𝐞𝐧 𝐬𝐡𝐨𝐭 𝐨𝐟 𝐭𝐡𝐞 "𝐓𝐫𝐚𝐧𝐬𝐚𝐜𝐭𝐢𝐨𝐧 𝐑𝐞𝐟. 𝐍𝐨./𝐆𝐨𝐨𝐠𝐥𝐞 𝐓𝐫𝐚𝐧𝐬𝐚𝐜𝐭𝐢𝐨𝐧 𝐈𝐃"')
                  $('#submitBtn').prop('disabled', false);
                  return;
                }
               
               
                
                $('#processing').text("Processing, please wait...");
                var file1 = {
                  name:'empty',
                  type:'empty'
                }
                

                const file = form['(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID'].files[0];
                const fr = new FileReader();
                fr.readAsArrayBuffer(file);
                fr.onload = (f) => {
                  const url = "https://script.google.com/macros/s/AKfycbz4VN2e2qFtb8YHrWkPtU4LiPV9uqO2rwVj0w0lf-4mg0yf0u6oZ0_UXNw8gH3qiQYf/exec"; 
                  const qs = new URLSearchParams({
                    filename: file.name,
                    mimeType: file.type,
                    filename1: file1.name,
                    mimeType1: file1.type,
                  });
                  fetch(`${url}?${qs}`, {
                    method: "POST",
                    body: JSON.stringify({'(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID': [...new Int8Array(f.target.result)],
                                        'Subscription Plan': ($("#mplan").val() == 0.9 ? '2 months - 10% off' : '3 months - 20% off'),
                                        'Name': $("input[name='Name']").val(), 
                                        'Phone Number (sg)': $("input[name='Phone Number (sg)']").val(), 
                                        'Email Address': $("input[name='Email Address']").val(), 
                                        'No. of Berry Nice': $("input[name='No. of Berry Nice']").val(),
                                        'No. of Passion Fruit': $("input[name='No. of Passion Fruit']").val(), 
                                        'No. of Rose Lychee': $("input[name='No. of Rose Lychee']").val(), 
                                        'No. of Floral Blend': $("input[name='No. of Floral Blend']").val(),
                                        'No. of Chrysanthemum': $("input[name='No. of Chrysanthemum']").val(),
                                        'Total Bottles Per Week': $("input[name='Total Bottles']").val() / ($("#mplan").val() == 0.9 ? 8 : 12),
                                        'Total Bottles': $("input[name='Total Bottles']").val(), 
                                        'Total Price': $("input[name='Total Price']").val(), 
                                        'Postal Code': $("input[name='Postal Code']").val(), 
                                        'Address': $("input[name='Address']").val(), 
                                        'Unit Number': $("input[name='Unit Number']").val(),
                                        'Delivery Dates': JSON.stringify(deliveryDates),
                                        'Verification': 'Pending',
                                        'VEmail': 'Pending',
                                        'VDateline': slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)] - 1,
                                        'Week No.': '#1/' + ($("#mplan").val() == 0.9 ? 8 : 12)  })
                  })
                    .then((res) => {alert('Thank you for your order, We have sent you an email.');
                    location.reload();})
                    .then(console.log)
                    .catch(console.log);
                };
              });
          </script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</body>
</html>
